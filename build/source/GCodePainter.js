/* Copyright (C) 1999 Masanao Izumo <iz@onicos.co.jp>
             * Version: 1.0.0.1
             * LastModified: Dec 25 1999
             */

(function(e,t){typeof define=="function"&&define.amd?define([],t):e.gCodePainter=t()})(this,function(){var e=function(){var e=function(){var e=32768,t=0,n=1,r=2,i=6,s=!0,o=32768,u=64,a=8192,f=2*e,l=3,c=258,h=16,p=8192,d=13;p>o&&alert("error: zip_INBUFSIZ is too small"),e<<1>1<<h&&alert("error: zip_WSIZE is too large"),d>h-1&&alert("error: zip_HASH_BITS is too large"),(d<8||c!=258)&&alert("error: Code too clever");var v=p,m=1<<d,g=m-1,y=e-1,b=0,w=4096,E=c+l+1,S=e-E,x=1,T=15,N=7,C=29,k=256,L=256,A=k+1+C,O=30,M=19,_=16,D=17,P=18,H=2*A+1,B=parseInt((d+l-1)/l,10),j,F,I,q,R=null,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht,Bt,jt,Ft,It,qt=function(){this.fc=0,this.dl=0},Rt=function(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0},Ut=function(e,t,n,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r},zt=function(){this.next=null,this.len=0,this.ptr=new Array(a),this.off=0},Wt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Xt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Vt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],$t=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Jt=[new Ut(0,0,0,0),new Ut(4,4,8,4),new Ut(4,5,16,8),new Ut(4,6,32,32),new Ut(4,4,16,16),new Ut(8,16,32,32),new Ut(8,16,128,128),new Ut(8,32,128,256),new Ut(32,128,258,1024),new Ut(32,258,258,4096)],Kt=function(e){var t;e?e<1?e=1:e>9&&(e=9):e=i,lt=e,q=!1,ot=!1;if(R!=null)return;j=F=I=null,R=new Array(a),X=new Array(f),V=new Array(v),$=new Array(o+u),J=new Array(1<<h),pt=new Array(H);for(t=0;t<H;t++)pt[t]=new qt;dt=new Array(2*O+1);for(t=0;t<2*O+1;t++)dt[t]=new qt;vt=new Array(A+2);for(t=0;t<A+2;t++)vt[t]=new qt;mt=new Array(O);for(t=0;t<O;t++)mt[t]=new qt;gt=new Array(2*M+1);for(t=0;t<2*M+1;t++)gt[t]=new qt;yt=new Rt,bt=new Rt,wt=new Rt,Et=new Array(T+1),St=new Array(2*A+1),Nt=new Array(2*A+1),Ct=new Array(c-l+1),kt=new Array(512),Lt=new Array(C),At=new Array(O),Ot=new Array(parseInt(p/8,10))},Qt=function(){j=F=I=null,R=null,X=null,V=null,$=null,J=null,pt=null,dt=null,vt=null,mt=null,gt=null,yt=null,bt=null,wt=null,Et=null,St=null,Nt=null,Ct=null,kt=null,Lt=null,At=null,Ot=null},Gt=function(e){e.next=j,j=e},Yt=function(){var e;return j!=null?(e=j,j=j.next):e=new zt,e.next=null,e.len=e.off=0,e},Zt=function(t){return J[e+t]},en=function(t,n){return J[e+t]=n},tn=function(e){R[z+U++]=e,z+U==a&&Pn()},nn=function(e){e&=65535,z+U<a-2?(R[z+U++]=e&255,R[z+U++]=e>>>8):(tn(e&255),tn(e>>>8))},rn=function(){Y=(Y<<B^X[it+l-1]&255)&g,Z=Zt(Y),J[it&y]=Z,en(Y,it)},sn=function(e,t){Mn(t[e].fc,t[e].dl)},on=function(e){return(e<256?kt[e]:kt[256+(e>>7)])&255},un=function(e,t,n){return e[t].fc<e[n].fc||e[t].fc==e[n].fc&&Nt[t]<=Nt[n]},an=function(e,t,n){var r,i=Ft.length;for(r=0;r<n&&It<i;r+=1)e[t+r]=Ft[It++];return r},fn=function(){var t;for(t=0;t<m;t++)J[e+t]=0;ft=Jt[lt].max_lazy,ct=Jt[lt].good_length,s||(ht=Jt[lt].nice_length),at=Jt[lt].max_chain,it=0,G=0,ut=an(X,0,2*e);if(ut<=0){ot=!0,ut=0;return}ot=!1;while(ut<E&&!ot)cn();Y=0;for(t=0;t<l-1;t++)Y=(Y<<B^X[t]&255)&g},ln=function(e){var t=at,n=it,r,i,o=rt,u=it>S?it-S:b,a=it+c,f=X[n+o-1],l=X[n+o];rt>=ct&&(t>>=2);do{r=e;if(X[r+o]!=l||X[r+o-1]!=f||X[r]!=X[n]||X[++r]!=X[n+1])continue;n+=2,r++;do;while(X[++n]==X[++r]&&X[++n]==X[++r]&&X[++n]==X[++r]&&X[++n]==X[++r]&&X[++n]==X[++r]&&X[++n]==X[++r]&&X[++n]==X[++r]&&X[++n]==X[++r]&&n<a);i=c-(a-n),n=a-c;if(i>o){st=e,o=i;if(s){if(i>=c)break}else if(i>=ht)break;f=X[n+o-1],l=X[n+o]}}while((e=J[e&y])>u&&--t!=0);return o},cn=function(){var t,n,r=f-ut-it;if(r==-1)r--;else if(it>=e+S){for(t=0;t<e;t++)X[t]=X[t+e];st-=e,it-=e,G-=e;for(t=0;t<m;t++)n=Zt(t),en(t,n>=e?n-e:b);for(t=0;t<e;t++)n=J[t],J[t]=n>=e?n-e:b;r+=e}ot||(t=an(X,it+ut,r),t<=0?ot=!0:ut+=t)},hn=function(){while(ut!=0&&F==null){var e;rn(),Z!=b&&it-Z<=S&&(nt=ln(Z),nt>ut&&(nt=ut));if(nt>=l){e=Ln(it-st,nt-l),ut-=nt;if(nt<=ft){nt--;do it++,rn();while(--nt!=0);it++}else it+=nt,nt=0,Y=X[it]&255,Y=(Y<<B^X[it+1]&255)&g}else e=Ln(0,X[it]&255),ut--,it++;e&&(kn(0),G=it);while(ut<E&&!ot)cn()}},pn=function(){while(ut!=0&&F==null){rn(),rt=nt,et=st,nt=l-1,Z!=b&&rt<ft&&it-Z<=S&&(nt=ln(Z),nt>ut&&(nt=ut),nt==l&&it-st>w&&nt--);if(rt>=l&&nt<=rt){var e;e=Ln(it-1-et,rt-l),ut-=rt-1,rt-=2;do it++,rn();while(--rt!=0);tt=0,nt=l-1,it++,e&&(kn(0),G=it)}else tt!=0?(Ln(0,X[it-1]&255)&&(kn(0),G=it),it++,ut--):(tt=1,it++,ut--);while(ut<E&&!ot)cn()}},dn=function(){if(ot)return;K=0,Q=0,gn(),fn(),F=null,U=0,z=0,lt<=3?(rt=l-1,nt=0):(nt=l-1,tt=0),W=!1},vn=function(e,t,n){var r;if(!q){dn(),q=!0;if(ut==0)return W=!0,0}return(r=mn(e,t,n))==n?n:W?r:(lt<=3?hn():pn(),ut==0&&(tt!=0&&Ln(0,X[it-1]&255),kn(1),W=!0),r+mn(e,r+t,n-r))},mn=function(e,t,n){var r,i,s;r=0;while(F!=null&&r<n){i=n-r,i>F.len&&(i=F.len);for(s=0;s<i;s++)e[t+r+s]=F.ptr[F.off+s];F.off+=i,F.len-=i,r+=i;if(F.len==0){var o;o=F,F=F.next,Gt(o)}}if(r==n)return r;if(z<U){i=n-r,i>U-z&&(i=U-z);for(s=0;s<i;s++)e[t+r+s]=R[z+s];z+=i,r+=i,U==z&&(U=z=0)}return r},gn=function(){var e,t,n,r,i;if(mt[0].dl!=0)return;yt.dyn_tree=pt,yt.static_tree=vt,yt.extra_bits=Wt,yt.extra_base=k+1,yt.elems=A,yt.max_length=T,yt.max_code=0,bt.dyn_tree=dt,bt.static_tree=mt,bt.extra_bits=Xt,bt.extra_base=0,bt.elems=O,bt.max_length=T,bt.max_code=0,wt.dyn_tree=gt,wt.static_tree=null,wt.extra_bits=Vt,wt.extra_base=0,wt.elems=M,wt.max_length=N,wt.max_code=0,n=0;for(r=0;r<C-1;r++){Lt[r]=n;for(e=0;e<1<<Wt[r];e++)Ct[n++]=r}Ct[n-1]=r,i=0;for(r=0;r<16;r++){At[r]=i;for(e=0;e<1<<Xt[r];e++)kt[i++]=r}i>>=7;for(;r<O;r++){At[r]=i<<7;for(e=0;e<1<<Xt[r]-7;e++)kt[256+i++]=r}for(t=0;t<=T;t++)Et[t]=0;e=0;while(e<=143)vt[e++].dl=8,Et[8]++;while(e<=255)vt[e++].dl=9,Et[9]++;while(e<=279)vt[e++].dl=7,Et[7]++;while(e<=287)vt[e++].dl=8,Et[8]++;En(vt,A+1);for(e=0;e<O;e++)mt[e].dl=5,mt[e].fc=_n(e,5);yn()},yn=function(){var e;for(e=0;e<A;e++)pt[e].fc=0;for(e=0;e<O;e++)dt[e].fc=0;for(e=0;e<M;e++)gt[e].fc=0;pt[L].fc=1,Bt=jt=0,Mt=_t=Dt=0,Pt=0,Ht=1},bn=function(e,t){var n=St[t],r=t<<1;while(r<=xt){r<xt&&un(e,St[r+1],St[r])&&r++;if(un(e,n,St[r]))break;St[t]=St[r],t=r,r<<=1}St[t]=n},wn=function(e){var t=e.dyn_tree,n=e.extra_bits,r=e.extra_base,i=e.max_code,s=e.max_length,o=e.static_tree,u,a,f,l,c,h,p=0;for(l=0;l<=T;l++)Et[l]=0;t[St[Tt]].dl=0;for(u=Tt+1;u<H;u++){a=St[u],l=t[t[a].dl].dl+1,l>s&&(l=s,p++),t[a].dl=l;if(a>i)continue;Et[l]++,c=0,a>=r&&(c=n[a-r]),h=t[a].fc,Bt+=h*(l+c),o!=null&&(jt+=h*(o[a].dl+c))}if(p==0)return;do{l=s-1;while(Et[l]==0)l--;Et[l]--,Et[l+1]+=2,Et[s]--,p-=2}while(p>0);for(l=s;l!=0;l--){a=Et[l];while(a!=0){f=St[--u];if(f>i)continue;t[f].dl!=l&&(Bt+=(l-t[f].dl)*t[f].fc,t[f].fc=l),a--}}},En=function(e,t){var n=new Array(T+1),r=0,i,s;for(i=1;i<=T;i++)r=r+Et[i-1]<<1,n[i]=r;for(s=0;s<=t;s++){var o=e[s].dl;if(o==0)continue;e[s].fc=_n(n[o]++,o)}},Sn=function(e){var t=e.dyn_tree,n=e.static_tree,r=e.elems,i,s,o=-1,u=r;xt=0,Tt=H;for(i=0;i<r;i++)t[i].fc!=0?(St[++xt]=o=i,Nt[i]=0):t[i].dl=0;while(xt<2){var a=St[++xt]=o<2?++o:0;t[a].fc=1,Nt[a]=0,Bt--,n!=null&&(jt-=n[a].dl)}e.max_code=o;for(i=xt>>1;i>=1;i--)bn(t,i);do i=St[x],St[x]=St[xt--],bn(t,x),s=St[x],St[--Tt]=i,St[--Tt]=s,t[u].fc=t[i].fc+t[s].fc,Nt[i]>Nt[s]+1?Nt[u]=Nt[i]:Nt[u]=Nt[s]+1,t[i].dl=t[s].dl=u,St[x]=u++,bn(t,x);while(xt>=2);St[--Tt]=St[x],wn(e),En(t,o)},xn=function(e,t){var n,r=-1,i,s=e[0].dl,o=0,u=7,a=4;s==0&&(u=138,a=3),e[t+1].dl=65535;for(n=0;n<=t;n++){i=s,s=e[n+1].dl;if(++o<u&&i==s)continue;o<a?gt[i].fc+=o:i!=0?(i!=r&&gt[i].fc++,gt[_].fc++):o<=10?gt[D].fc++:gt[P].fc++,o=0,r=i,s==0?(u=138,a=3):i==s?(u=6,a=3):(u=7,a=4)}},Tn=function(e,t){var n,r=-1,i,s=e[0].dl,o=0,u=7,a=4;s==0&&(u=138,a=3);for(n=0;n<=t;n++){i=s,s=e[n+1].dl;if(++o<u&&i==s)continue;if(o<a){do sn(i,gt);while(--o!=0)}else i!=0?(i!=r&&(sn(i,gt),o--),sn(_,gt),Mn(o-3,2)):o<=10?(sn(D,gt),Mn(o-3,3)):(sn(P,gt),Mn(o-11,7));o=0,r=i,s==0?(u=138,a=3):i==s?(u=6,a=3):(u=7,a=4)}},Nn=function(){var e;xn(pt,yt.max_code),xn(dt,bt.max_code),Sn(wt);for(e=M-1;e>=3;e--)if(gt[$t[e]].dl!=0)break;return Bt+=3*(e+1)+5+5+4,e},Cn=function(e,t,n){var r;Mn(e-257,5),Mn(t-1,5),Mn(n-4,4);for(r=0;r<n;r++)Mn(gt[$t[r]].dl,3);Tn(pt,e-1),Tn(dt,t-1)},kn=function(e){var i,s,o,u;u=it-G,Ot[Dt]=Pt,Sn(yt),Sn(bt),o=Nn(),i=Bt+3+7>>3,s=jt+3+7>>3,s<=i&&(i=s);if(u+4<=i&&G>=0){var a;Mn((t<<1)+e,3),Dn(),nn(u),nn(~u);for(a=0;a<u;a++)tn(X[G+a])}else s==i?(Mn((n<<1)+e,3),An(vt,mt)):(Mn((r<<1)+e,3),Cn(yt.max_code+1,bt.max_code+1,o+1),An(pt,dt));yn(),e!=0&&Dn()},Ln=function(e,t){$[Mt++]=t,e==0?pt[t].fc++:(e--,pt[Ct[t]+k+1].fc++,dt[on(e)].fc++,V[_t++]=e,Pt|=Ht),Ht<<=1,(Mt&7)==0&&(Ot[Dt++]=Pt,Pt=0,Ht=1);if(lt>2&&(Mt&4095)==0){var n=Mt*8,r=it-G,i;for(i=0;i<O;i++)n+=dt[i].fc*(5+Xt[i]);n>>=3;if(_t<parseInt(Mt/2,10)&&n<parseInt(r/2,10))return!0}return Mt==p-1||_t==v},An=function(e,t){var n,r,i=0,s=0,o=0,u=0,a,f;if(Mt!=0)do(i&7)==0&&(u=Ot[o++]),r=$[i++]&255,(u&1)==0?sn(r,e):(a=Ct[r],sn(a+k+1,e),f=Wt[a],f!=0&&(r-=Lt[a],Mn(r,f)),n=V[s++],a=on(n),sn(a,t),f=Xt[a],f!=0&&(n-=At[a],Mn(n,f))),u>>=1;while(i<Mt);sn(L,e)},On=16,Mn=function(e,t){Q>On-t?(K|=e<<Q,nn(K),K=e>>On-Q,Q+=t-On):(K|=e<<Q,Q+=t)},_n=function(e,t){var n=0;do n|=e&1,e>>=1,n<<=1;while(--t>0);return n>>1},Dn=function(){Q>8?nn(K):Q>0&&tn(K),K=0,Q=0},Pn=function(){if(U!=0){var e,t;e=Yt(),F==null?F=I=e:I=I.next=e,e.len=U-z;for(t=0;t<e.len;t++)e.ptr[t]=R[z+t];U=z=0}},Hn=function(e,t){var n,r;Ft=e,It=0,typeof t=="undefined"&&(t=i),Kt(t);var s=[0],o=[];while((n=vn(s,0,s.length))>0)o.push(s[0]);return Ft=null,new Uint8Array(o)};return Hn}(),t=function(){var e=32768,t=0,n=1,r=2,i=9,s=6,o=32768,u=64,a,f,l=null,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535),k=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0),L=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99),A=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577),O=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),M=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),_=function(){this.next=null,this.list=null},D=function(){this.e=0,this.b=0,this.n=0,this.t=null},P=function(e,t,n,r,i,s){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var o,u=new Array(this.BMAX+1),a,f,l,c,h,p,d,v=new Array(this.BMAX+1),m,g,y,b=new D,w=new Array(this.BMAX),E=new Array(this.N_MAX),S,x=new Array(this.BMAX+1),T,N,C,k,L;L=this.root=null;for(h=0;h<u.length;h++)u[h]=0;for(h=0;h<v.length;h++)v[h]=0;for(h=0;h<w.length;h++)w[h]=null;for(h=0;h<E.length;h++)E[h]=0;for(h=0;h<x.length;h++)x[h]=0;a=t>256?e[256]:this.BMAX,m=e,g=0,h=t;do u[m[g]]++,g++;while(--h>0);if(u[0]==t){this.root=null,this.m=0,this.status=0;return}for(p=1;p<=this.BMAX;p++)if(u[p]!=0)break;d=p,s<p&&(s=p);for(h=this.BMAX;h!=0;h--)if(u[h]!=0)break;l=h,s>h&&(s=h);for(N=1<<p;p<h;p++,N<<=1)if((N-=u[p])<0){this.status=2,this.m=s;return}if((N-=u[h])<0){this.status=2,this.m=s;return}u[h]+=N,x[1]=p=0,m=u,g=1,T=2;while(--h>0)x[T++]=p+=m[g++];m=e,g=0,h=0;do(p=m[g++])!=0&&(E[x[p]++]=h);while(++h<t);t=x[l],x[0]=h=0,m=E,g=0,c=-1,S=v[0]=0,y=null,C=0;for(;d<=l;d++){o=u[d];while(o-->0){while(d>S+v[1+c]){S+=v[1+c],c++,C=(C=l-S)>s?s:C;if((f=1<<(p=d-S))>o+1){f-=o+1,T=d;while(++p<C){if((f<<=1)<=u[++T])break;f-=u[T]}}S+p>a&&S<a&&(p=a-S),C=1<<p,v[1+c]=p,y=new Array(C);for(k=0;k<C;k++)y[k]=new D;L==null?L=this.root=new _:L=L.next=new _,L.next=null,L.list=y,w[c]=y,c>0&&(x[c]=h,b.b=v[c],b.e=16+p,b.t=y,p=(h&(1<<S)-1)>>S-v[c],w[c-1][p].e=b.e,w[c-1][p].b=b.b,w[c-1][p].n=b.n,w[c-1][p].t=b.t)}b.b=d-S,g>=t?b.e=99:m[g]<n?(b.e=m[g]<256?16:15,b.n=m[g++]):(b.e=i[m[g]-n],b.n=r[m[g++]-n]),f=1<<d-S;for(p=h>>S;p<C;p+=f)y[p].e=b.e,y[p].b=b.b,y[p].n=b.n,y[p].t=b.t;for(p=1<<d-1;(h&p)!=0;p>>=1)h^=p;h^=p;while((h&(1<<S)-1)!=x[c])S-=v[c],c--}}this.m=v[1],this.status=N!=0&&l!=1?1:0},H=function(){return T.length==N?-1:T[N++]},B=function(e){while(v<e)d|=H()<<v,v+=8},j=function(e){return d&C[e]},F=function(e){d>>=e,v-=e},I=function(t,n,r){var i,s,o;if(r==0)return 0;o=0;for(;;){B(S),s=w.list[j(S)],i=s.e;while(i>16){if(i==99)return-1;F(s.b),i-=16,B(i),s=s.t[j(i)],i=s.e}F(s.b);if(i==16){f&=e-1,t[n+o++]=a[f++]=s.n;if(o==r)return r;continue}if(i==15)break;B(i),y=s.n+j(i),F(i),B(x),s=E.list[j(x)],i=s.e;while(i>16){if(i==99)return-1;F(s.b),i-=16,B(i),s=s.t[j(i)],i=s.e}F(s.b),B(i),b=f-s.n-j(i),F(i);while(y>0&&o<r)y--,b&=e-1,f&=e-1,t[n+o++]=a[f++]=a[b++];if(o==r)return r}return m=-1,o},q=function(t,n,r){var i;i=v&7,F(i),B(16),i=j(16),F(16),B(16);if(i!=(~d&65535))return-1;F(16),y=i,i=0;while(y>0&&i<r)y--,f&=e-1,B(8),t[n+i++]=a[f++]=j(8),F(8);return y==0&&(m=-1),i},R=function(e,t,n){if(l==null){var r,i=new Array(288),s;for(r=0;r<144;r++)i[r]=8;for(;r<256;r++)i[r]=9;for(;r<280;r++)i[r]=7;for(;r<288;r++)i[r]=8;h=7,s=new P(i,288,257,k,L,h);if(s.status!=0)return alert("HufBuild error: "+s.status),-1;l=s.root,h=s.m;for(r=0;r<30;r++)i[r]=5;var o=5;s=new P(i,30,0,A,O,o);if(s.status>1)return l=null,alert("HufBuild error: "+s.status),-1;c=s.root,o=s.m}return w=l,E=c,S=h,x=o,I(e,t,n)},U=function(e,t,n){var r,o,u,a,f,l,c,h,p=new Array(316),d;for(r=0;r<p.length;r++)p[r]=0;B(5),c=257+j(5),F(5),B(5),h=1+j(5),F(5),B(4),l=4+j(4),F(4);if(c>286||h>30)return-1;for(o=0;o<l;o++)B(3),p[M[o]]=j(3),F(3);for(;o<19;o++)p[M[o]]=0;S=7,d=new P(p,19,19,null,null,S);if(d.status!=0)return-1;w=d.root,S=d.m,a=c+h,r=u=0;while(r<a){B(S),f=w.list[j(S)],o=f.b,F(o),o=f.n;if(o<16)p[r++]=u=o;else if(o==16){B(2),o=3+j(2),F(2);if(r+o>a)return-1;while(o-->0)p[r++]=u}else if(o==17){B(3),o=3+j(3),F(3);if(r+o>a)return-1;while(o-->0)p[r++]=0;u=0}else{B(7),o=11+j(7),F(7);if(r+o>a)return-1;while(o-->0)p[r++]=0;u=0}}S=i,d=new P(p,c,257,k,L,S),S==0&&(d.status=1);if(d.status!=0)return d.status==1,-1;w=d.root,S=d.m;for(r=0;r<h;r++)p[r]=p[r+c];return x=s,d=new P(p,h,0,A,O,x),E=d.root,x=d.m,x==0&&c>257?-1:(d.status==1,d.status!=0?-1:I(e,t,n))},z=function(){var t;a==null&&(a=new Array(2*e)),f=0,d=0,v=0,m=-1,g=!1,y=b=0,w=null},W=function(n,r,i){var s,o;s=0;while(s<i){if(g&&m==-1)return s;if(y>0){if(m!=t)while(y>0&&s<i)y--,b&=e-1,f&=e-1,n[r+s++]=a[f++]=a[b++];else{while(y>0&&s<i)y--,f&=e-1,B(8),n[r+s++]=a[f++]=j(8),F(8);y==0&&(m=-1)}if(s==i)return s}if(m==-1){if(g)break;B(1),j(1)!=0&&(g=!0),F(1),B(2),m=j(2),F(2),w=null,y=0}switch(m){case 0:o=q(n,r+s,i-s);break;case 1:w!=null?o=I(n,r+s,i-s):o=R(n,r+s,i-s);break;case 2:w!=null?o=I(n,r+s,i-s):o=U(n,r+s,i-s);break;default:o=-1}if(o==-1)return g?0:-1;s+=o}return s},X=function(e){var t,n;z(),T=e,N=0;var r=[0],i=[];while((t=W(r,0,r.length))>0)i.push(r[0]);return T=null,new Uint8Array(i)};return X}(),n=function(e){var t=1,n=0,r,i=e.length,s=65521;for(r=0;r<i;r+=1)t=(t+e[r])%s,n=(n+t)%s;return n<<16|t},r=function(t,r){t=new Uint8Array(t);var i=n(t),s=e(t,r);return t=new Uint8Array(s.length+6),t[0]=120,t[1]=218,t.set(s,2),t.set(new Uint8Array((new Int32Array([i])).buffer),t.byteLength-4),t},i=function(e){if(e.byteLength<6)throw"DataError: Not enough input";e=new Uint8Array(e);var r=(new Int32Array((new Uint8Array(e.subarray(e.byteLength-4,e.byteLength))).buffer))[0],i=t(e.subarray(2,e.byteLength-4)),s=n(i);if(e.byteLength>6&&i.byteLength===0)throw"DataError: Unable to inflate the data";if(r!==s)throw"DataError: Checksum don't match";return i};return{deflate:e,inflate:t,compress:r,uncompress:i}}(),t=function(){function H(e){s=[],i=[],P(e.target.result),n=e.target.result.split(/\n/),r.getWorker().postMessage({cmd:"parseGCode",msg:{gcode:n,options:{firstReport:5}}})}function B(e){for(var t in e)N[t]=e[t]}function j(){N.sortLayers&&k(),N.purgeEmptyLayers&&L(),r.doPaint(s,0)}function F(e){s[e.layerNum]=e.cmds,i[e.zHeightObject.zValue]=e.zHeightObject.layer}function I(e){for(var t=0;t<e.layerNum.length;t++)s[e.layerNum[t]]=e.model[e.layerNum[t]],i[e.zHeightObject.zValue[t]]=e.layerNum[t]}function q(e){u=e.min,o=e.max,a=e.modelSize,h=e.totalFilament,f=e.filamentByLayer,l=e.filamentByExtruder,y=e.speeds,w=e.speedsByLayer,p=e.printTime,c=e.printTimeByLayer,v=e.layerHeight,m=e.layerCnt,g=e.layerTotal,E=e.volSpeeds,S=e.volSpeedsByLayer,x=e.extrusionSpeeds,T=e.extrusionSpeedsByLayer;var t=1;N.filamentType==="ABS"?t=1.04:N.filamentType==="PLA"&&(t=1.24),d=t*3.141*N.filamentDia/10*N.filamentDia/10/4*h/10,N.wh=parseFloat(N.nozzleDia)/parseFloat(v);if(b==="Slic3r"||b==="cura")N.wh=N.wh*1.1}function R(e){return f[e]}function U(e){return w[e]?w[e]:{}}function z(){return{min:u,max:o,modelSize:a,totalFilament:h,filamentByExtruder:l,speeds:y,speedsByLayer:w,printTime:p,printTimeByLayer:c,totalWeight:d,layerHeight:v,layerCnt:m,layerTotal:g,volSpeeds:E,volSpeedsByLayer:S,extrusionSpeeds:x,extrusionSpeedsByLayer:T}}function W(e,t,n){var r=0,i={first:s[e][t].gcodeLine,last:s[e][n].gcodeLine};return i}function X(){return N}var t,n,i={},s=[],o={x:undefined,y:undefined,z:undefined},u={x:undefined,y:undefined,z:undefined},a={x:undefined,y:undefined,z:undefined},f={},l={},c,h=0,p=0,d=0,v=0,m=0,g=0,y={},b="unknown",w={},E={},S={},x={},T={},N={sortLayers:!1,purgeEmptyLayers:!0,analyzeModel:!1,filamentType:"ABS",filamentDia:1.75,nozzleDia:.4},C=function(){if(!n)return;t=[];var e;for(e=0;e<n.length;e++)n[e].match(/^(G0|G1|G90|G91|G92|M82|M83|G28)/i)&&t.push(n[e]);n=[]},k=function(){var e=[],t=[];for(var n in i)e[i[n]]=n;e.sort(function(e,t){return e-t});for(var r=0;r<e.length;r++){if(typeof i[e[r]]=="undefined")continue;t[r]=s[i[e[r]]]}s=t},L=function(){var e=!0;if(!s){console.log("Something terribly wrong just happened.");return}for(var t=0;t<s.length;t++){e=!0;if(typeof s[t]=="undefined")e=!0;else for(var n=0;n<s[t].length;n++)s[t][n].extrude&&(e=!1);e&&(s.splice(t,1),t--)}},A=function(e){var t=e.match(/extrusion_width_mm\s*=\s*(\d*\.\d+)/m);t&&(N.nozzleDia=t[1]);var n=e.match(/fiber_dia_mm\s*=\s*(\d*\.\d+)/m);n&&(N.filamentDia=n[1])},O=function(e){var t=e.match(/nozzle_diameter\s*=\s*(\d*\.\d+)/m);t&&(N.nozzleDia=t[1]);var n=e.match(/filament_diameter\s*=\s*(\d*\.\d+)/m);n&&(N.filamentDia=n[1])},M=function(e){var t=e.match(/nozzle_diameter\s*=\s*(\d*\.\d+)/m);t&&(N.nozzleDia=t[1]);var n=e.match(/Filament_Diameter_(mm)\s*:\s*(\d*\.\d+)/m);n&&(N.filamentDia=n[1])},_=function(e){},D=function(t){var n=t.match(/CURA_PROFILE_STRING:((?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{4}))/m);if(n){var r=window.atob(n[1]),i=new Uint8Array(new ArrayBuffer(r.length)),s=0;for(s=0;s<r.length;s++)i[s]=r.charCodeAt(s);var o=new e.inflate(i.subarray(2,i.byteLength-4)),u;for(s=0;s<o.length;s+=1)u+=String.fromCharCode(o[s]);var a=u.match(/nozzle_size\s*=\s*(\d*\.\d+)/m);a&&(N.nozzleDia=a[1]);var f=u.match(/filament_diameter\s*=\s*(\d*\.\d+)/m);f&&(N.filamentDia=f[1])}},P=function(e){e.match(/Slic3r/)?(b="Slic3r",O(e)):e.match(/KISSlicer/)?(b="KISSlicer",A(e)):e.match(/skeinforge/)?(b="skeinforge",M(e)):e.match(/CURA_PROFILE_STRING/)?(b="cura",D(e)):e.match(/Miracle/)&&(b="makerbot",_(e))};return{loadFile:H,setOption:B,passDataToRenderer:j,processLayerFromWorker:F,processMultiLayerFromWorker:I,processAnalyzeModelDone:q,getLayerFilament:R,getLayerSpeeds:U,getModelInfo:z,getGCodeLines:W,getOptions:X}}(),n=function(){function P(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=t.createSVGMatrix();e.getTransform=function(){return n};var r=[],i=e.save;e.save=function(){return r.push(n.translate(0,0)),i.call(e)};var s=e.restore;e.restore=function(){return n=r.pop(),s.call(e)};var o=e.scale;e.scale=function(t,r){return n=n.scaleNonUniform(t,r),o.call(e,t,r)};var u=e.rotate;e.rotate=function(t){return n=n.rotate(t*180/Math.PI),u.call(e,t)};var a=e.translate;e.translate=function(t,r){return n=n.translate(t,r),a.call(e,t,r)};var f=e.transform;e.transform=function(r,i,s,o,u,a){var l=t.createSVGMatrix();return l.a=r,l.b=i,l.c=s,l.d=o,l.e=u,l.f=a,n=n.multiply(l),f.call(e,r,i,s,o,u,a)};var l=e.setTransform;e.setTransform=function(t,r,i,s,o,u){return n.a=t,n.b=r,n.c=i,n.d=s,n.e=o,n.f=u,l.call(e,t,r,i,s,o,u)};var c=t.createSVGPoint();e.transformedPoint=function(e,t){return c.x=e,c.y=t,c.matrixTransform(n.inverse())}}function F(e){H(e),S=!0,n.translate((e.width-s*r)/2,o*r+(e.height-o*r)/2)}function I(e){for(var t in e)e.hasOwnProperty(t)&&(T[t]=e[t]);S&&D()}function q(){return T}function R(){return E}function U(i,s,o){var u=t.getOptions();if(!S){console.error("gCodePainter canvas not initialized");return}if(!E)B();else if(i<E.length){var a=n.transformedPoint(0,0),f=n.transformedPoint(e.width,e.height);n.clearRect(a.x,a.y,f.x-a.x,f.y-a.y),B(),T.alpha?n.globalAlpha=.6:n.globalAlpha=1,T.actualWidth?T.extrusionWidth=u.filamentDia*u.wh/r:T.extrusionWidth=u.filamentDia*u.wh/r/2,T.showNextLayer&&i<E.length-1&&j(i+1,0,W(i+1),!0),j(i,s,o)}else console.log("Got request to render non-existent layer!!")}function z(){return E?E.length:1}function W(e){return E?E[e]?E[e].length:1:1}function X(e){U(e,0,E[e].length)}function V(i,u){var a;E=i,l=0,c=0,S||F(),a=t.getModelInfo(),k=a.speeds,L=a.speedsByLayer,A=a.volSpeeds,O=a.volSpeedsByLayer,M=a.extrusionSpeeds,_=a.extrusionSpeedsByLayer,N=(s/2-(a.min.x+a.modelSize.x/2))*r,C=(a.min.y+a.modelSize.y/2)*r-o/2*r,n&&n.translate(N,C);var f=a.modelSize.x>a.modelSize.y?e.width/a.modelSize.x/r:e.height/a.modelSize.y/r,h=n.transformedPoint(e.width/2,e.height/2),p=n.getTransform(),d=f/p.a,v=f/p.d;n.translate(h.x,h.y),n.scale(.98*d,.98*v),n.translate(-h.x,-h.y),U(u,1,E[u].length)}function $(e){if(!E&&!E[e])return"-1";var t=E[e];for(var n=0;n<t.length;n++)if(t[n].prevZ!==undefined)return t[n].prevZ;return"-1"}var e,n,r=3,i=.4,s=200,o=200,u=10,a,f,l=0,c=0,h,p,d,v={from:0,to:-1},m,g,y,b,w=1.1,E,S=!1,x={speed:1,expermm:2,volpersec:3},T={showMoves:!0,showRetracts:!0,colorGrid:"#bbbbbb",extrusionWidth:1,colorLine:["#000000","#45c7ba","#a9533a","#ff44cc","#dd1177","#eeee22","#ffbb55","#ff5511","#777788","#ff0000","#ffff00"],colorLineLen:9,colorMove:"#00ff00",colorRetract:"#ff0000",colorRestart:"#0000ff",sizeRetractSpot:2,modelCenter:{x:0,y:0},moveModel:!0,differentiateColors:!0,showNextLayer:!1,alpha:!1,actualWidth:!1,renderErrors:!1,renderAnalysis:!1,speedDisplayType:x.speed},N=0,C=0,k=[],L={},A=[],O={},M=[],_={},D=function(){var i=t.getOptions(),s=n.transformedPoint(0,0),o=n.transformedPoint(e.width,e.height);n.clearRect(s.x,s.y,o.x-s.x,o.y-s.y),B(),T.alpha?n.globalAlpha=.6:n.globalAlpha=1,T.actualWidth?T.extrusionWidth=i.filamentDia*i.wh/r:T.extrusionWidth=i.filamentDia*i.wh/r/2,T.showNextLayer&&d<E.length-1&&j(d+1,0,W(d+1),!0),j(d,v.from,v.to)},H=function(t){e=t;var r=e.getContext("2d");r.canvas.style.width="800px",r.canvas.style.height="600px",r.canvas.width=800,r.canvas.height=600;if(!e.getContext)throw"exception";n=e.getContext("2d"),a=e.height,f=e.width,m=f/2,g=a/2,n.lineWidth=2,n.lineCap="round",P(n)},B=function(){var e;n.strokeStyle=T.colorGrid,n.lineWidth=1;var t=0,i=0;T.moveModel&&(t=N,i=C),n.beginPath();for(e=0;e<=s;e+=u)n.moveTo(e*r-t,0-i),n.lineTo(e*r-t,-o*r-i);n.stroke(),n.beginPath();for(e=0;e<=o;e+=u)n.moveTo(0-t,-e*r-i),n.lineTo(s*r-t,-e*r-i);n.stroke()},j=function(e,t,i,s){var o,u=0,a=0;s=typeof s!="undefined"?s:!1,s||(d=e,v={from:t,to:i});if(!E||!E[e])return;var f=E[e],h,p;if(t>0)l=f[t-1].x*r,c=-f[t-1].y*r;else if(t===0&&e===0)E[0]&&typeof E[0].x!="undefined"&&typeof E[0].y!="undefined"?(l=E[0].x*r,c=-E[0].y*r):(l=0,c=0);else if(typeof f[0].prevX!="undefined"&&typeof f[0].prevY!="undefined")l=f[0].prevX*r,c=-f[0].prevY*r;else if(E[e-1]){l=undefined,c=undefined;for(o=E[e-1].length-1;o>=0;o--)typeof l=="undefined"&&E[e-1][o].x!==undefined&&(l=E[e-1][o].x*r),typeof c=="undefined"&&E[e-1][o].y!==undefined&&(c=-E[e-1][o].y*r);typeof l=="undefined"&&(l=0),typeof c=="undefined"&&(c=0)}else l=0,c=0;a=$(e);for(o=t;o<=i;o++){n.lineWidth=1;if(typeof f[o]=="undefined")continue;typeof f[o].prevX!="undefined"&&typeof f[o].prevY!="undefined"&&(l=f[o].prevX*r,c=-f[o].prevY*r),typeof f[o].x=="undefined"||isNaN(f[o].x)?h=l/r:h=f[o].x,typeof f[o].y=="undefined"||isNaN(f[o].y)?p=c/r:p=-f[o].y,T.differentiateColors&&!T.showNextLayer&&!T.renderAnalysis?(T.speedDisplayType===x.speed?u=k.extrude.indexOf(f[o].speed):T.speedDisplayType===x.expermm?u=A.indexOf(f[o].volPerMM):T.speedDisplayType===x.volpersec?u=M.indexOf((f[o].volPerMM*f[o].speed/60).toFixed(3)):u=0,u===-1?u=0:u>T.colorLineLen-1&&(u%=T.colorLineLen-1)):T.showNextLayer&&s?u=3:T.renderErrors?f[o].errType===2?u=9:f[o].errType===1?u=10:u=0:T.renderAnalysis?e!==0?u=-1:u=0:u=0;if(!f[o].extrude&&!f[o].noMove)f[o].retract==-1&&T.showRetracts&&(n.strokeStyle=T.colorRestart,n.fillStyle=T.colorRestart,n.beginPath(),n.arc(l,c,T.sizeRetractSpot,0,Math.PI*2,!0),n.stroke(),n.fill()),T.showMoves&&(n.strokeStyle=T.showMoves,n.beginPath(),n.moveTo(l,c),n.lineTo(h*r,p*r),n.stroke());else if(f[o].extrude)if(f[o].retract===0){if(u>=0)n.strokeStyle=T.colorLine[u];else if(u===-1){var m=parseInt(f[o].errLevelB).toString(16),g="#"+"00".substr(0,2-m.length)+m+"0000";m=parseInt(f[o].errLevelE).toString(16);var y="#"+"00".substr(0,2-m.length)+m+"0000",b=n.createLinearGradient(l,c,h*r,p*r),w;f[o].errType===1?(w=1-f[o].errDelimiter,w>=.99&&(w=.99),b.addColorStop(0,"#000000"),b.addColorStop(w,"#000000"),b.addColorStop(w+.01,y),b.addColorStop(1,y)):f[o].errType===2?(b.addColorStop(0,g),w=f[o].errDelimiter,w>=.99&&(w=.99),b.addColorStop(w,g),b.addColorStop(w+.01,"#000000"),b.addColorStop(1,"#000000")):(b.addColorStop(0,g),b.addColorStop(1,y)),n.strokeStyle=b}n.lineWidth=T.extrusionWidth,n.beginPath(),n.moveTo(l,c),n.lineTo(h*r,p*r),n.stroke()}else T.showRetracts&&(n.strokeStyle=T.colorRestart,n.fillStyle=T.colorRestart,n.beginPath(),n.arc(l,c,T.sizeRetractSpot,0,Math.PI*2,!0),n.stroke(),n.fill());l=h*r,c=p*r}n.stroke()};return{init:F,setOption:I,getOptions:q,debugGetModel:R,render:U,getModelNumLayers:z,getLayerNumSegments:W,renderLayer:X,doRender:V,getZ:$}}(),r=function(){function s(e){o(e),u()}function o(e){i=document.createElement("canvas"),document.getElementById(e).appendChild(i),n.init(i)}function u(){var i="";e=new Worker("source/GCodeWorker.js"),e.onmessage=function(s){var o=s.data;switch(o.cmd){case"returnModel":e.postMessage({cmd:"analyzeModel",msg:{}});break;case"analyzeDone":r.onParseProgress(100),t.processAnalyzeModelDone(o.msg),t.passDataToRenderer(),document.getElementById("gcodeRangeSlider").max=n.getModelNumLayers()-1;break;case"returnLayer":t.processLayerFromWorker(o.msg);break;case"returnMultiLayer":t.processMultiLayerFromWorker(o.msg),i+=".",r.onParseProgress("loading "+i),i.length>4&&(i=".");break;case"analyzeProgress":i+=".",r.onParseProgress("loading "+i),i.length>4&&(i=".");break;default:console.log("default msg received"+o.cmd)}}}function a(e){var n=new FileReader;n.onload=function(e){t.loadFile(e)},n.readAsText(e)}function f(e){var n={target:{result:null}},r=new XMLHttpRequest;r.overrideMimeType("text/plain"),r.open("GET",e,!0),r.addEventListener("load",function(e){var r=e.target.response;n.target.result=r,this.status===200?t.loadFile(n):this.status===0&&(console.warn("HTTP Status 0 received."),t.loadFile(n))},!1),r.send(null)}function l(e,t){n.doRender(e,t)}function c(){return e}function h(e){n.renderLayer(e)}function p(e){document.getElementById("StatePanel").innerHTML=e}var e=null,i=null;return{init:s,loadFile:a,loadUrl:f,doPaint:l,getWorker:c,paintLayer:h,onParseProgress:p}}();return r});